# 마자무 홈페이지 수정요청사항 통합 정리

> **작성일**: 2025-11-22
> **문서 목적**: 클라이언트로부터 제공받은 "마자무 홈페이지 1차 수정안", "마자무 홈페이지 2차 수정안" PDF 파일을 기반으로 모든 수정 요청사항을 체계적으로 정리하고 구현 방향을 명확히 함

---

## 📋 목차

1. [프로젝트 현황 분석](#1-프로젝트-현황-분석)
2. [1차 수정안 요청사항](#2-1차-수정안-요청사항)
3. [2차 수정안 요청사항 (오류 수정 및 기능 추가)](#3-2차-수정안-요청사항-오류-수정-및-기능-추가)
4. [우선순위별 구현 계획](#4-우선순위별-구현-계획)
5. [구현 상세 가이드](#5-구현-상세-가이드)

---

## 1. 프로젝트 현황 분석

### 1.1 프로젝트 구조
```
app/
├── page.tsx (루트 → /login 리다이렉트)
├── dashboard/              # 사용자 대시보드
│   ├── reward/            # 리워드 관리
│   │   ├── submit/        # 리워드 접수
│   │   └── status/        # 접수 현황 확인
│   ├── review/            # 리뷰 마케팅
│   │   ├── visitor/       # 방문자 리뷰 (네이버 영수증)
│   │   └── kmap/          # 카카오맵 리뷰
│   ├── experience/        # 체험단 마케팅
│   ├── blog-distribution/ # 블로그 배포
│   │   ├── [type]/       # 영상/자동화/리뷰어 배포
│   │   └── status/        # 접수 현황
│   └── cafe/              # 카페 마케팅
└── admin/                 # 관리자 페이지
    ├── submissions/       # 전체 접수 내역
    ├── reports/          # 리포트 관리
    ├── clients/          # 클라이언트 관리
    └── ...
```

### 1.2 주요 기술 스택
- **Framework**: Next.js 15 (App Router)
- **언어**: TypeScript
- **UI**: Tailwind CSS + shadcn/ui
- **Database**: Supabase
- **State**: React useState/useEffect

---

## 2. 1차 수정안 요청사항

### 2.1 리워드 시스템

#### 🔹 리워드 접수 페이지 (`/dashboard/reward/submit`)

**[REQ-R-001] 구동일수 입력 방식 변경**
- **현재**: 드롭다운 형식 (Select)
- **요청**: 단문 텍스트 입력 (Input type="number")
- **기본값**: 7일 자동 설정 (사용자가 다른 값 입력 가능)
- **구현 파일**: `app/dashboard/reward/submit/reward-submit-form.tsx` (예상)
- **영향도**: 🟡 중간
- **비고**: 가장 많이 주문되는 일수가 7일

**[REQ-R-002] 접수 후 잔액 표시 제거**
- **현재**: 접수 완료 후 "접수 후 잔액" 표시
- **요청**: 해당 필드 완전 삭제
- **이유**: 좌측 패널에 이미 잔액이 표시되어 중복
- **구현 파일**: `reward-submit-form.tsx`
- **영향도**: 🟢 낮음

#### 🔹 리워드 접수 현황 페이지 (`/dashboard/reward/status`)

**[REQ-R-003] 총 비용 노출 제거**
- **현재**: 접수 현황 테이블에 "총 비용" 컬럼 존재
- **요청**: 총 비용 컬럼 완전 삭제 (비공개)
- **구현 파일**: `app/dashboard/reward/status/page.tsx`
- **영향도**: 🟢 낮음
- **현재 코드**: 234번 라인 `총 비용` 통계 카드, 291번 라인 테이블 헤더, 354번 라인 데이터 셀

---

### 2.2 리뷰 마케팅 시스템

#### 🔹 방문자 리뷰 (네이버 영수증) (`/dashboard/review/visitor`)

**[REQ-RM-001] 최소 주문건수 제한 (30건)**
- **현재**: 제한 없음 (1건*3일=3건도 가능)
- **요청**: 총 발행수량이 최소 30건 이상이어야 접수 가능
- **검증 로직**: `dailyCount * totalDays >= 30`
- **구현 파일**: `app/dashboard/review/visitor/page.tsx`
- **영향도**: 🟡 중간
- **에러 메시지**: "총 발행수량은 최소 30건 이상이어야 합니다. (현재: {totalCount}건)"

**[REQ-RM-002] 기본값 10일 고정**
- **현재**: 사용자가 입력
- **요청**: `totalDays` 기본값을 10일로 설정 (변경 가능)
- **구현 파일**: `app/dashboard/review/visitor/page.tsx`
- **영향도**: 🟢 낮음
- **비고**: 10일이 가장 많이 주문되는 일수

**[REQ-RM-003] 건당 단가 표시 제거**
- **현재**: 결제 정보 섹션에 "건당 단가 5,000P" 표시
- **요청**: 건당 단가 카드 완전 삭제
- **구현 파일**: `app/dashboard/review/visitor/page.tsx`
- **영향도**: 🟢 낮음
- **현재 코드**: 518-531번 라인 "건당 단가" 카드

#### 🔹 K맵 리뷰 (카카오맵) (`/dashboard/review/kmap`)

**[REQ-RM-004] 최소 주문건수 제한 (10건)**
- **현재**: 제한 없음
- **요청**: 총 발행수량이 최소 10건 이상이어야 접수 가능
- **검증 로직**: `dailyCount * totalDays >= 10`
- **구현 파일**: `app/dashboard/review/kmap/page.tsx`
- **영향도**: 🟡 중간

**[REQ-RM-005] 기본값 10일 고정**
- **현재**: 사용자가 입력
- **요청**: `totalDays` 기본값을 10일로 설정 (변경 가능)
- **구현 파일**: `app/dashboard/review/kmap/page.tsx`
- **영향도**: 🟢 낮음

---

### 2.3 체험단 마케팅 시스템

#### 🔹 실계정 기자단 (`/dashboard/experience/[service]`)

**[REQ-EM-001] 이미지 첨부 기능 개선**
- **현재**: 사용자가 직접 이미지 업로드
- **요청**:
  1. 메일 주소를 기입하여 이메일로 전송받거나
  2. 데이터베이스에 미리 로딩된 이미지 선택
- **구현 방향**:
  - Option 1: 이메일 입력 필드 추가 → 파일 전송 API 연동
  - Option 2: 관리자가 미리 업로드한 이미지 갤러리에서 선택
- **영향도**: 🔴 높음
- **추가 요구사항**: 클라이언트와 세부 구현 방식 협의 필요

---

### 2.4 블로그 배포 시스템

#### 🔹 전체 공통 - 지도 기능

**[REQ-BD-001] 지도 삽입 생략 옵션 제거**
- **현재**: "지도 삽입 생략" 체크박스 존재
- **요청**: 체크박스 완전 제거 (지도 삽입 필수)
- **구현 파일**:
  - `app/dashboard/blog-distribution/[type]/page.tsx` (533-548번 라인)
- **영향도**: 🟢 낮음

**[REQ-BD-002] 플레이스 링크 필수 입력**
- **현재**: 지도 생략 시 플레이스 링크 생략 가능
- **요청**: 플레이스 링크를 항상 필수 입력으로 변경
- **영향도**: 🟢 낮음

#### 🔹 리뷰어 배포 (`/dashboard/blog-distribution/reviewer`)

**[REQ-BD-003] 외부 링크 옵션 추가**
- **현재**: 플레이스 링크만 입력 가능
- **요청**:
  - "플레이스 링크" 또는 "외부 링크" 중 하나만 입력하면 진행 가능
  - 외부 링크: 쇼핑몰 상품 URL, 홈페이지 URL 등
- **구현 방향**:
  - "플레이스 링크" 입력 필드
  - "외부 링크" 입력 필드 추가
  - 둘 중 하나만 필수 (OR 조건)
- **영향도**: 🟡 중간

---

### 2.5 리워드 - 매체 선택 섹션

**[REQ-R-004] 투플 리워드 설명 추가**
- **현재**: 매체 선택 드롭다운 (또는 라디오 버튼)
- **요청**:
  - 앞으로 [투플]만 사용 예정
  - 매체 선택 UI를 제거하고, [투플] 리워드에 대한 설명 텍스트로 대체
  - 세로 높이를 줄여서 간결하게 표시
- **구현 방향**:
  - Select/Radio 제거
  - 안내 문구 추가 (예: "본 서비스는 투플(TOOFLE) 리워드를 통해 진행됩니다.")
  - 추가 설명 텍스트 (클라이언트로부터 전달받을 예정)
- **영향도**: 🟡 중간

---

### 2.6 카테고리 명 변경

**[REQ-NAV-001] 좌측 네비게이션 메뉴명 변경**

| 현재 카테고리 | 현재 하위 메뉴 | 변경 후 하위 메뉴 |
|------------|-------------|-------------|
| 리워드 | - | - 리워드 접수<br>- 접수 현황 확인 |
| 리뷰 마케팅 | - | - 네이버 영수증<br>- 카카오맵 |
| 체험단 마케팅 | - | - 블로그 체험단<br>- 샤오홍슈(중국인 체험단)<br>- 블로그 기자단<br>- 블로그 인플루언서 |
| 블로그 배포 | - | - 영상 배포<br>- 자동화 배포<br>- 리뷰어 배포 |

- **구현 파일**:
  - `components/layout/sidebar.tsx` (또는 네비게이션 관련 컴포넌트)
- **영향도**: 🟢 낮음
- **주의**: 초록색 표시된 부분만 변경 (메인 카테고리명은 유지)

---

### 2.7 좌측 패널 (사이드바) 개선

**[REQ-PANEL-001] 포인트 표시 자동 축소**
- **현재**: 10만원 단위까지는 문제 없으나, 100만원 단위에서 레이아웃 깨질 가능성
- **요청**:
  - 100만원 이상 금액도 자동으로 축소되어 표시되도록 개선
  - 또는 전체를 20% 정도 작게 만들어도 괜찮음
- **구현 방향**:
  - CSS: `font-size` 동적 조절 (금액 길이에 따라)
  - 또는 전체 패널 크기를 `scale(0.8)` 적용
- **영향도**: 🟡 중간

**[REQ-PANEL-002] 공지사항/개인알림 개발 확인**
- **현재**: 개발 상태 불명
- **요청**:
  - 공지사항/개인알림 기능이 개발되었는지 확인
  - 미개발 시 우선순위 논의 필요
- **영향도**: 🔴 높음 (확인 필요)

**[REQ-PANEL-003] 마자무 캐릭터 클릭 시 홈 이동**
- **현재**: 캐릭터 클릭 시 동작 없음
- **요청**: 캐릭터 클릭 시 `/dashboard`로 이동
- **구현**: `<Link href="/dashboard">` 추가
- **영향도**: 🟢 낮음

**[REQ-PANEL-004] 각 카테고리별 현황 확인 기능 추가**
- **현재**: 리워드만 "접수 현황 확인" 페이지 존재
- **요청**: 모든 카테고리에 접수 현황 확인 페이지 추가
  - 리뷰 마케팅 현황
  - 체험단 마케팅 현황
  - 블로그 배포 현황
  - 카페 마케팅 현황
- **구현 방향**:
  - 각 서비스별 `/status` 페이지 생성
  - 통합 대시보드에 전체 현황 요약 표시
- **영향도**: 🔴 높음

---

### 2.8 전체 페이지 공통 기능

**[REQ-COMMON-001] 페이지별 공지사항/가이드 영역 추가**
- **현재**: 공지사항/가이드 영역 없음
- **요청**:
  - 각 페이지 상단에 공지사항/가이드 영역 추가
  - 상품 설명, 이용 가이드, 주의사항 등을 관리자가 입력 가능
- **구현 방향**:
  - 페이지별 안내 문구를 DB에 저장 (`page_notices` 테이블)
  - 각 페이지에서 해당 페이지의 공지사항을 불러와 상단에 표시
  - 관리자 페이지에서 각 페이지별 공지사항 편집 가능
- **영향도**: 🔴 높음

**[REQ-COMMON-002] 플레이스 링크 → 업체명 자동 추출**
- **현재**: 업체명을 사용자가 직접 입력
- **요청**:
  - 플레이스 링크를 입력하면 자동으로 업체명을 불러오기
  - Naver Place API 활용 (MID 기반)
- **구현 방향**:
  - URL에서 MID 추출 (정규식)
  - Naver Place API 호출하여 업체명 가져오기
  - 자동 입력 (수정 가능)
- **영향도**: 🔴 높음
- **참고**: 2차 수정안에서 더 상세히 다룸

---

## 3. 2차 수정안 요청사항 (오류 수정 및 기능 추가)

### 3.1 플레이스 링크 → 업체명 자동 추출 (공통)

**[REQ-FIX-001] MID 기반 업체명 자동 추출 구현**

**문제점**:
- 현재 플레이스 링크를 입력해도 업체명이 자동으로 불러와지지 않음

**지원해야 할 URL 형식** (MID 값 추출):
```
1. https://m.place.naver.com/restaurant/2052133358
2. https://m.place.naver.com/restaurant/2052133358/home?entry=plt
3. https://map.naver.com/p/entry/place/2052133358?lng=126.6494306&lat=37.3958625&placePath=%2Fhome&entry=plt&searchType=place&c=15.00,0,0,0,dh
4. https://map.naver.com/p/entry/place/2052133358
```

**공통점**: MID 값 `2052133358`

**구현 방향**:
1. **MID 추출 정규식**:
   ```typescript
   const extractMID = (url: string): string | null => {
     const match = url.match(/place\/(\d+)/);
     return match ? match[1] : null;
   };
   ```

2. **업체명 가져오기**:
   - Option 1: Naver Place API 활용 (공식 API 확인 필요)
   - Option 2: 웹 스크래핑 (Playwright/Puppeteer)
   - Option 3: 프록시 API 서버 구축

3. **구현 파일**:
   - `utils/naver-place.ts` (새로 생성)
   - 모든 접수 페이지에서 재사용

4. **UX**:
   - 플레이스 링크 입력 시 자동으로 MID 추출
   - 로딩 인디케이터 표시
   - 업체명 자동 입력 (수정 가능)
   - MID 표시 (확인용)

**영향도**: 🔴 높음

---

### 3.2 관리자 페이지 - 접수 내역 오류

**[REQ-FIX-002] 전체 접수내역과 상세 내역 데이터 불일치 수정**

**문제점**:
- 전체 접수 내역 리스트에서 보이는 정보와
- 개별 상세 내역에서 보이는 정보가 서로 다름

**구현 파일**:
- `app/admin/submissions/page.tsx`
- `app/admin/submissions/[id]/page.tsx` (예상)

**원인 분석 필요**:
- DB 쿼리 불일치?
- 데이터 변환 로직 오류?
- 캐싱 문제?

**영향도**: 🔴 높음

---

### 3.3 관리자 페이지 - 리포트 관리

**[REQ-FIX-003] 리포트 엑셀 다운로드 기능 개선**

**현재**:
- 리포트 엑셀 다운로드 시 기본 정보만 포함

**요청**:
- 상세 내역 포함:
  - 일건수
  - 총건수
  - 입력 키워드
  - 가이드 텍스트
  - 기타 접수 시 입력한 모든 정보

**구현 파일**:
- `app/admin/reports/page.tsx`
- API: `app/api/admin/reports/export/route.ts` (새로 생성)

**영향도**: 🟡 중간

---

**[REQ-FIX-004] 리워드 접수 후 관리자 현황에 미표시 오류**

**문제점**:
- 리워드 접수 완료 후
- 사용자 화면에서는 접수가 완료되었으나
- 관리자 페이지에서 해당 접수 내역이 보이지 않음

**원인 분석 필요**:
- DB 트랜잭션 롤백?
- 권한 필터링 오류?
- API 응답 성공했으나 실제 DB 저장 실패?

**구현 파일**:
- `app/api/submissions/reward/route.ts`
- `app/admin/submissions/page.tsx`

**영향도**: 🔴 높음 (핵심 기능 오류)

---

### 3.4 관리자 페이지 - 충전하기 기능

**[REQ-FIX-005] 충전 요청 기능 미반영**

**문제점**:
- "충전하기" 버튼 클릭 시 충전 요청이 제대로 반영되지 않음

**확인 필요**:
- 충전 요청 API가 구현되어 있는지?
- DB에 충전 요청 데이터가 저장되는지?
- 관리자가 충전 요청을 확인하고 승인하는 플로우가 있는지?

**구현 파일**:
- `app/dashboard/points/page.tsx` (예상)
- `app/api/points/charge-request/route.ts` (새로 생성 필요?)

**영향도**: 🔴 높음

---

### 3.5 관리자 페이지 - 리포트 등록 기능

**[REQ-FEAT-001] 관리자 리포트 등록 기능 개발**

**현재**:
- 사용자는 리포트 다운로드 기능이 있음
- 하지만 관리자가 리포트를 등록하는 기능이 없음

**요청**:
1. **개별 리포트 등록**:
   - 접수 ID를 선택하여 리포트 파일 업로드

2. **대량 리포트 등록** (중요):
   - 엑셀 파일 업로드
   - 엑셀 파일 형식:
     ```
     | 접수 ID | 리포트 파일명/URL | 비고 |
     |--------|----------------|------|
     | 1      | report_1.pdf   | ...  |
     | 2      | report_2.pdf   | ...  |
     ```
   - 자동으로 각 캠페인에 리포트 매칭
   - 일괄 등록 완료 후 알림

**구현 방향**:
- 관리자 페이지에 "리포트 관리" 메뉴 추가
- 개별 등록 UI
- 대량 등록 UI (엑셀 업로드 + 파싱)
- 리포트 파일 저장 (Supabase Storage)
- DB 연결 (`submission_reports` 테이블)

**구현 파일**:
- `app/admin/reports/upload/page.tsx` (새로 생성)
- `app/api/admin/reports/upload/route.ts` (새로 생성)
- `app/api/admin/reports/bulk-upload/route.ts` (새로 생성)

**영향도**: 🔴 높음

**추가 협의 필요**:
- 엑셀 파일 정확한 형식
- 리포트 파일 업로드 방식 (직접 업로드 vs URL 입력)
- 자동 매칭 로직 상세

---

## 4. 우선순위별 구현 계획

### 🔴 우선순위 1 (긴급 - 핵심 기능 오류)

| 요청 ID | 제목 | 예상 공수 | 파일 |
|--------|------|---------|------|
| REQ-FIX-002 | 접수 내역 데이터 불일치 수정 | 4h | `app/admin/submissions/*` |
| REQ-FIX-004 | 리워드 접수 후 미표시 오류 | 4h | `app/api/submissions/reward/*` |
| REQ-FIX-005 | 충전하기 기능 미반영 | 3h | `app/api/points/*` |
| REQ-FIX-001 | 플레이스 링크 → 업체명 자동 추출 | 6h | `utils/naver-place.ts` (신규) |
| REQ-FEAT-001 | 관리자 리포트 등록 기능 | 8h | `app/admin/reports/upload/*` (신규) |

**총 예상 공수**: 25시간

---

### 🟡 우선순위 2 (중요 - 사용성 개선)

| 요청 ID | 제목 | 예상 공수 | 파일 |
|--------|------|---------|------|
| REQ-R-001 | 구동일수 Input으로 변경 + 기본값 7일 | 1h | `app/dashboard/reward/submit/*` |
| REQ-RM-001 | 방문자 리뷰 최소 30건 제한 | 1h | `app/dashboard/review/visitor/*` |
| REQ-RM-004 | K맵 리뷰 최소 10건 제한 | 1h | `app/dashboard/review/kmap/*` |
| REQ-RM-002 | 방문자 리뷰 기본값 10일 | 0.5h | `app/dashboard/review/visitor/*` |
| REQ-RM-005 | K맵 리뷰 기본값 10일 | 0.5h | `app/dashboard/review/kmap/*` |
| REQ-BD-003 | 외부 링크 옵션 추가 | 2h | `app/dashboard/blog-distribution/reviewer/*` |
| REQ-R-004 | 투플 설명 추가 | 2h | `app/dashboard/reward/submit/*` |
| REQ-PANEL-001 | 포인트 표시 자동 축소 | 2h | `components/layout/sidebar.tsx` |
| REQ-PANEL-004 | 카테고리별 현황 확인 추가 | 6h | 각 서비스별 `/status` 페이지 |
| REQ-COMMON-001 | 페이지별 공지사항 영역 | 6h | 전체 페이지 + 관리자 |
| REQ-FIX-003 | 리포트 엑셀 상세내역 포함 | 3h | `app/api/admin/reports/*` |

**총 예상 공수**: 25시간

---

### 🟢 우선순위 3 (일반 - 마이너 개선)

| 요청 ID | 제목 | 예상 공수 | 파일 |
|--------|------|---------|------|
| REQ-R-002 | 접수 후 잔액 표시 제거 | 0.5h | `app/dashboard/reward/submit/*` |
| REQ-R-003 | 리워드 총 비용 노출 제거 | 0.5h | `app/dashboard/reward/status/*` |
| REQ-RM-003 | 방문자 리뷰 건당 단가 제거 | 0.5h | `app/dashboard/review/visitor/*` |
| REQ-BD-001 | 지도 생략 옵션 제거 | 0.5h | `app/dashboard/blog-distribution/*` |
| REQ-BD-002 | 플레이스 링크 필수 입력 | 0.5h | `app/dashboard/blog-distribution/*` |
| REQ-NAV-001 | 카테고리 명 변경 | 1h | `components/layout/sidebar.tsx` |
| REQ-PANEL-003 | 캐릭터 클릭 시 홈 이동 | 0.5h | `components/layout/sidebar.tsx` |

**총 예상 공수**: 4시간

---

### ⚠️ 확인 필요 항목

| 요청 ID | 제목 | 확인 사항 |
|--------|------|---------|
| REQ-PANEL-002 | 공지사항/개인알림 개발 확인 | 현재 개발 상태 확인 필요 |
| REQ-EM-001 | 이미지 첨부 기능 개선 | 클라이언트와 구현 방식 협의 필요 |
| REQ-FEAT-001 | 대량 리포트 등록 | 엑셀 형식 및 자동 매칭 로직 상세 협의 |

---

## 5. 구현 상세 가이드

### 5.1 플레이스 링크 → 업체명 자동 추출 (REQ-FIX-001)

**Step 1: MID 추출 유틸리티 함수 생성**

```typescript
// utils/naver-place.ts

/**
 * 네이버 플레이스 URL에서 MID(Place ID) 추출
 */
export function extractNaverPlaceMID(url: string): string | null {
  if (!url) return null;

  // 정규식: place/ 뒤의 숫자를 추출
  const match = url.match(/place\/(\d+)/);
  return match ? match[1] : null;
}

/**
 * MID로 업체명 가져오기
 * @param mid - Naver Place MID
 * @returns 업체명 (실패 시 null)
 */
export async function fetchBusinessNameByMID(mid: string): Promise<string | null> {
  try {
    // Option 1: Naver Place API (공식 API 확인 필요)
    // Option 2: 프록시 서버를 통한 스크래핑
    // Option 3: 서버 사이드에서 Playwright 사용

    const response = await fetch(`/api/naver-place/${mid}`);
    if (!response.ok) return null;

    const data = await response.json();
    return data.businessName || null;
  } catch (error) {
    console.error('업체명 가져오기 실패:', error);
    return null;
  }
}
```

**Step 2: API 라우트 생성**

```typescript
// app/api/naver-place/[mid]/route.ts

import { NextRequest, NextResponse } from 'next/server';

export async function GET(
  request: NextRequest,
  { params }: { params: { mid: string } }
) {
  const { mid } = params;

  try {
    // 실제 구현: Naver Place 데이터 가져오기
    // 여기서는 웹 스크래핑 또는 API 호출 필요

    // 임시 구현 (실제로는 외부 API 또는 스크래핑 필요)
    const businessName = await scrapeNaverPlace(mid);

    return NextResponse.json({
      success: true,
      businessName,
      mid,
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: '업체 정보를 가져올 수 없습니다.' },
      { status: 500 }
    );
  }
}

async function scrapeNaverPlace(mid: string): Promise<string> {
  // TODO: Playwright 또는 API를 사용하여 실제 구현
  // 현재는 placeholder
  return `업체명_${mid}`;
}
```

**Step 3: 컴포넌트에 적용**

```typescript
// 모든 접수 페이지에 적용

const [formData, setFormData] = useState({
  businessName: '',
  placeUrl: '',
  placeMid: '',
  // ...
});
const [loadingBusinessName, setLoadingBusinessName] = useState(false);

const handlePlaceUrlChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const url = e.target.value;
  setFormData(prev => ({ ...prev, placeUrl: url }));

  // MID 추출
  const mid = extractNaverPlaceMID(url);
  if (mid) {
    setFormData(prev => ({ ...prev, placeMid: mid }));

    // 업체명 자동 가져오기
    setLoadingBusinessName(true);
    const businessName = await fetchBusinessNameByMID(mid);
    setLoadingBusinessName(false);

    if (businessName) {
      setFormData(prev => ({ ...prev, businessName }));
      toast({
        title: '✅ 업체명 자동 입력 완료',
        description: `"${businessName}"이(가) 입력되었습니다.`,
      });
    }
  }
};
```

---

### 5.2 최소 주문건수 제한 (REQ-RM-001, REQ-RM-004)

**방문자 리뷰 (30건 제한)**:

```typescript
// app/dashboard/review/visitor/page.tsx

const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();

  // 최소 30건 검증
  if (formData.totalCount < 30) {
    toast({
      variant: 'destructive',
      title: '입력 오류',
      description: `총 발행수량은 최소 30건 이상이어야 합니다. (현재: ${formData.totalCount}건)`,
    });
    return;
  }

  // ... 기존 로직
};
```

**K맵 리뷰 (10건 제한)**:

```typescript
// app/dashboard/review/kmap/page.tsx

const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();

  // 최소 10건 검증
  if (formData.totalCount < 10) {
    toast({
      variant: 'destructive',
      title: '입력 오류',
      description: `총 발행수량은 최소 10건 이상이어야 합니다. (현재: ${formData.totalCount}건)`,
    });
    return;
  }

  // ... 기존 로직
};
```

---

### 5.3 기본값 설정 (REQ-R-001, REQ-RM-002, REQ-RM-005)

**리워드 접수 (7일 기본값)**:

```typescript
// app/dashboard/reward/submit/reward-submit-form.tsx

const [formData, setFormData] = useState({
  // ...
  operationDays: 7, // 기본값 7일
});

// Input으로 변경
<Input
  id="operationDays"
  type="number"
  min="1"
  value={formData.operationDays}
  onChange={(e) => setFormData(prev => ({ ...prev, operationDays: Number(e.target.value) }))}
  className="border-gray-200 focus:border-sky-500 h-9 text-sm"
/>
```

**방문자 리뷰 & K맵 리뷰 (10일 기본값)**:

```typescript
const [formData, setFormData] = useState({
  // ...
  totalDays: 10, // 기본값 10일
});
```

---

### 5.4 UI 요소 제거 (REQ-R-002, REQ-R-003, REQ-RM-003, REQ-BD-001)

**예시: 방문자 리뷰 건당 단가 제거**

```typescript
// app/dashboard/review/visitor/page.tsx
// 518-531번 라인 삭제

// 삭제 전:
<div className="p-3 rounded-lg border border-purple-200 bg-purple-50">
  <div className="space-y-1">
    <span className="text-xs font-medium text-purple-600">건당 단가</span>
    <div className="flex items-baseline gap-1">
      <span className="text-2xl font-bold text-purple-900">
        5,000
      </span>
      <span className="text-sm text-purple-700">P</span>
    </div>
    <div className="text-xs text-purple-600">
      방문자 리뷰
    </div>
  </div>
</div>

// 삭제 후: (위 코드 전체 제거)
```

---

### 5.5 관리자 리포트 등록 기능 (REQ-FEAT-001)

**DB 스키마 (예상)**:

```sql
-- submission_reports 테이블
CREATE TABLE submission_reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  submission_id UUID REFERENCES submissions(id) ON DELETE CASCADE,
  report_file_url TEXT NOT NULL,
  uploaded_by UUID REFERENCES admin_users(id),
  uploaded_at TIMESTAMPTZ DEFAULT NOW(),
  notes TEXT
);
```

**대량 엑셀 업로드 API**:

```typescript
// app/api/admin/reports/bulk-upload/route.ts

import { NextRequest, NextResponse } from 'next/server';
import * as XLSX from 'xlsx';

export async function POST(request: NextRequest) {
  try {
    const formData = await request.formData();
    const file = formData.get('excel') as File;

    if (!file) {
      return NextResponse.json({ error: '파일이 없습니다.' }, { status: 400 });
    }

    // 엑셀 파일 파싱
    const buffer = await file.arrayBuffer();
    const workbook = XLSX.read(buffer);
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(sheet);

    // 각 행에서 접수 ID와 리포트 URL 추출하여 DB에 저장
    const results = [];
    for (const row of data) {
      const submissionId = row['접수 ID'];
      const reportUrl = row['리포트 URL'];

      if (submissionId && reportUrl) {
        // DB 저장
        const result = await saveReport(submissionId, reportUrl);
        results.push(result);
      }
    }

    return NextResponse.json({
      success: true,
      totalProcessed: results.length,
      results,
    });
  } catch (error) {
    console.error('대량 업로드 실패:', error);
    return NextResponse.json(
      { error: '대량 업로드 중 오류가 발생했습니다.' },
      { status: 500 }
    );
  }
}

async function saveReport(submissionId: string, reportUrl: string) {
  // Supabase에 저장
  // ...
}
```

---

## 6. 추가 협의 필요 사항

### 6.1 REQ-EM-001 (이미지 첨부 기능)
- 메일 전송 방식인지, DB 로딩 방식인지 명확히 결정 필요
- 메일 전송 시: 전송 대상 메일 주소 확정
- DB 로딩 시: 이미지 관리 인터페이스 설계 필요

### 6.2 REQ-FEAT-001 (대량 리포트 등록)
- 엑셀 파일의 정확한 컬럼 구조 확정
- 리포트 파일 업로드 방식 (직접 업로드 vs URL)
- 자동 매칭 실패 시 처리 방법
- 등록 후 사용자 알림 방식

### 6.3 REQ-FIX-001 (플레이스 링크 자동 추출)
- Naver Place API 사용 가능 여부 확인
- API 사용 불가 시 대체 방안 (웹 스크래핑, Playwright)
- 추출 실패 시 대체 플로우

---

## 7. 예상 총 개발 기간

| 우선순위 | 예상 공수 | 비고 |
|---------|---------|------|
| 🔴 우선순위 1 | 25시간 | 핵심 기능 오류 수정 |
| 🟡 우선순위 2 | 25시간 | 사용성 개선 |
| 🟢 우선순위 3 | 4시간 | 마이너 개선 |
| **총합** | **54시간** | 약 7일 (1일 8시간 기준) |

---

## 8. 다음 단계

1. ✅ **이 문서를 클라이언트에게 공유**하여 요구사항 확인
2. ⏳ **추가 협의 필요 항목 확정** (6장 참고)
3. ⏳ **우선순위 1부터 순차적으로 구현 시작**
4. ⏳ **각 단계별 테스트 및 클라이언트 검수**
5. ⏳ **최종 배포 및 사용자 가이드 작성**

---

## 📌 참고 자료

- PDF 1: 마자무 홈페이지 1차 수정안.pdf
- PDF 2: 마자무 홈페이지 2차 수정안.pdf
- 프로젝트 구조: `app/` 디렉토리 분석 결과

---

**작성자**: Claude Code (AI Assistant)
**최종 수정일**: 2025-11-22
