# ì¤‘ë‹¨ ìš”ì²­ ì‹œìŠ¤í…œ êµ¬í˜„ ê³„íšì„œ

## 1. ê°œìš”

### 1.1 í˜„ì¬ ë¬¸ì œì 
- **ë²„ê·¸**: ì¹´í˜ ë§ˆì¼€íŒ… ìƒí’ˆì—ì„œ `in_progress` ìƒíƒœì¼ ë•Œ í”„ë¡ íŠ¸ì—”ë“œëŠ” ì¤‘ë‹¨ ë²„íŠ¼ì„ í‘œì‹œí•˜ì§€ë§Œ, ë°±ì—”ë“œ APIëŠ” ê±°ë¶€í•¨
- **êµ¬ì¡°ì  ë¬¸ì œ**: í˜„ì¬ ì¤‘ë‹¨ ìš”ì²­ ì‹œ ì¦‰ì‹œ ì·¨ì†Œë˜ì–´ ê´€ë¦¬ì ê²€í†  ì—†ì´ í™˜ë¶ˆ ì²˜ë¦¬ë¨

### 1.2 ìš”êµ¬ì‚¬í•­
1. ì¤‘ë‹¨ ìš”ì²­ ì‹œ ì¦‰ì‹œ ì·¨ì†Œê°€ ì•„ë‹Œ **ìš”ì²­ â†’ ìŠ¹ì¸** í”„ë¡œì„¸ìŠ¤ë¡œ ë³€ê²½
2. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì— ì¤‘ë‹¨ ìš”ì²­ ì•Œë¦¼ í‘œì‹œ
3. AS ê´€ë¦¬ íƒ­ì—ì„œ ì¤‘ë‹¨ ìš”ì²­ ë³„ë„ ê´€ë¦¬
4. ê´€ë¦¬ìê°€ ì§„í–‰ë¥  í™•ì¸ í›„ í™˜ë¶ˆ ê¸ˆì•¡ ì¡°ì • ê°€ëŠ¥
5. ê° ìƒí’ˆë³„ ì ‘ìˆ˜ ë‚´ì—­ì— ì¤‘ë‹¨ëœ í•­ëª©ì˜ í™˜ë¶ˆ ê¸ˆì•¡ í‘œì‹œ

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 2.1 ì‹ ê·œ í…Œì´ë¸”: `cancellation_requests`

```sql
CREATE TABLE IF NOT EXISTS cancellation_requests (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- ê´€ê³„ ì •ë³´
  client_id UUID NOT NULL REFERENCES clients(id),
  submission_type VARCHAR(50) NOT NULL, -- place, receipt, kakaomap, blog, cafe
  submission_id UUID NOT NULL,

  -- ìš”ì²­ ì •ë³´
  reason TEXT, -- ì¤‘ë‹¨ ì‚¬ìœ  (ì„ íƒ)

  -- ì§„í–‰ ìƒí™© (ìš”ì²­ ì‹œì  ìŠ¤ëƒ…ìƒ·)
  total_count INTEGER NOT NULL, -- ì´ ì˜ˆì • ìˆ˜ëŸ‰
  completed_count INTEGER NOT NULL DEFAULT 0, -- ì™„ë£Œ ìˆ˜ëŸ‰
  progress_rate DECIMAL(5,2) NOT NULL DEFAULT 0, -- ì§„í–‰ë¥  (%)

  -- ë¹„ìš© ì •ë³´
  total_points INTEGER NOT NULL, -- ì´ ê²°ì œ í¬ì¸íŠ¸
  calculated_refund INTEGER NOT NULL, -- ìë™ ê³„ì‚°ëœ í™˜ë¶ˆ ê¸ˆì•¡
  final_refund INTEGER, -- ê´€ë¦¬ì í™•ì • í™˜ë¶ˆ ê¸ˆì•¡ (NULLì´ë©´ ë¯¸ì²˜ë¦¬)

  -- ìƒíƒœ ê´€ë¦¬
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  -- pending: ëŒ€ê¸°, approved: ìŠ¹ì¸(í™˜ë¶ˆì™„ë£Œ), rejected: ê±°ì ˆ

  admin_response TEXT, -- ê´€ë¦¬ì ì‘ë‹µ ë©”ì‹œì§€
  processed_by UUID REFERENCES admins(id), -- ì²˜ë¦¬í•œ ê´€ë¦¬ì
  processed_at TIMESTAMP WITH TIME ZONE, -- ì²˜ë¦¬ ì‹œê°„

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_cancellation_requests_client ON cancellation_requests(client_id);
CREATE INDEX idx_cancellation_requests_status ON cancellation_requests(status);
CREATE INDEX idx_cancellation_requests_submission ON cancellation_requests(submission_type, submission_id);
CREATE INDEX idx_cancellation_requests_created ON cancellation_requests(created_at DESC);

-- RLS ì •ì±…
ALTER TABLE cancellation_requests ENABLE ROW LEVEL SECURITY;
```

### 2.2 ê¸°ì¡´ submission í…Œì´ë¸” ìƒíƒœ ì¶”ê°€

ê° submission í…Œì´ë¸”ì— `cancellation_requested` ìƒíƒœ ì¶”ê°€:
- `place_submissions`
- `receipt_review_submissions`
- `kakaomap_review_submissions`
- `blog_distribution_submissions`
- `cafe_marketing_submissions`

```sql
-- ìƒíƒœ ê°’ ì²´í¬ ì œì•½ ì¡°ê±´ ì—…ë°ì´íŠ¸ (ì˜ˆì‹œ: blog_distribution_submissions)
ALTER TABLE blog_distribution_submissions
DROP CONSTRAINT IF EXISTS blog_distribution_submissions_status_check;

ALTER TABLE blog_distribution_submissions
ADD CONSTRAINT blog_distribution_submissions_status_check
CHECK (status IN (
  'pending', 'approved', 'in_progress', 'completed', 'cancelled',
  'cancellation_requested', 'cancellation_approved'
));
```

### 2.3 ì•Œë¦¼ íŠ¸ë¦¬ê±° í•¨ìˆ˜

```sql
-- ì¤‘ë‹¨ ìš”ì²­ ìƒì„± ì‹œ ê´€ë¦¬ì ì•Œë¦¼
CREATE OR REPLACE FUNCTION notify_cancellation_request_created()
RETURNS trigger AS $$
BEGIN
  INSERT INTO notifications (type, title, message, data, recipient_role)
  VALUES (
    'cancellation_request_created',
    'ìƒˆë¡œìš´ ì¤‘ë‹¨ ìš”ì²­',
    'ì§„í–‰ë¥  ' || NEW.progress_rate || '%ì˜ ì¤‘ë‹¨ ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤',
    json_build_object(
      'cancellation_request_id', NEW.id,
      'client_id', NEW.client_id,
      'submission_type', NEW.submission_type,
      'submission_id', NEW.submission_id,
      'progress_rate', NEW.progress_rate,
      'calculated_refund', NEW.calculated_refund
    ),
    'admin'
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER cancellation_request_created_trigger
AFTER INSERT ON cancellation_requests
FOR EACH ROW EXECUTE FUNCTION notify_cancellation_request_created();

-- ì¤‘ë‹¨ ìš”ì²­ ì²˜ë¦¬ ì‹œ ê±°ë˜ì²˜ ì•Œë¦¼
CREATE OR REPLACE FUNCTION notify_cancellation_request_processed()
RETURNS trigger AS $$
BEGIN
  IF NEW.status != OLD.status AND NEW.status IN ('approved', 'rejected') THEN
    INSERT INTO notifications (type, title, message, data, recipient_id, recipient_role)
    VALUES (
      CASE WHEN NEW.status = 'approved'
        THEN 'cancellation_approved'
        ELSE 'cancellation_rejected'
      END,
      CASE WHEN NEW.status = 'approved'
        THEN 'ì¤‘ë‹¨ ìš”ì²­ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤'
        ELSE 'ì¤‘ë‹¨ ìš”ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤'
      END,
      CASE WHEN NEW.status = 'approved'
        THEN 'í™˜ë¶ˆ ê¸ˆì•¡: ' || NEW.final_refund || 'Pê°€ í™˜ë¶ˆë˜ì—ˆìŠµë‹ˆë‹¤.'
        ELSE COALESCE(NEW.admin_response, 'ì¤‘ë‹¨ ìš”ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.')
      END,
      json_build_object(
        'cancellation_request_id', NEW.id,
        'submission_type', NEW.submission_type,
        'submission_id', NEW.submission_id,
        'final_refund', NEW.final_refund,
        'link', '/dashboard/submissions'
      ),
      NEW.client_id,
      'client'
    );
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER cancellation_request_processed_trigger
AFTER UPDATE ON cancellation_requests
FOR EACH ROW EXECUTE FUNCTION notify_cancellation_request_processed();
```

---

## 3. API ì„¤ê³„

### 3.1 í´ë¼ì´ì–¸íŠ¸ìš© API

#### POST `/api/cancellation-requests` - ì¤‘ë‹¨ ìš”ì²­ ìƒì„±

```typescript
// app/api/cancellation-requests/route.ts

interface CancellationRequestBody {
  submission_type: 'place' | 'receipt' | 'kakaomap' | 'blog' | 'cafe';
  submission_id: string;
  reason?: string;
}

// Response
{
  success: true,
  cancellationRequest: {
    id: string,
    status: 'pending',
    progress_rate: number,
    calculated_refund: number,
    // ...
  }
}
```

#### GET `/api/cancellation-requests` - ë‚´ ì¤‘ë‹¨ ìš”ì²­ ëª©ë¡

```typescript
// í´ë¼ì´ì–¸íŠ¸: ìì‹ ì˜ ìš”ì²­ë§Œ ì¡°íšŒ
// ê´€ë¦¬ì: ì „ì²´ ìš”ì²­ ì¡°íšŒ

// Response
{
  cancellationRequests: CancellationRequest[]
}
```

### 3.2 ê´€ë¦¬ììš© API

#### PATCH `/api/cancellation-requests/[id]` - ì¤‘ë‹¨ ìš”ì²­ ì²˜ë¦¬

```typescript
// app/api/cancellation-requests/[id]/route.ts

interface ProcessRequestBody {
  status: 'approved' | 'rejected';
  final_refund?: number; // ìŠ¹ì¸ ì‹œ í™•ì • í™˜ë¶ˆ ê¸ˆì•¡
  admin_response?: string; // ê±°ì ˆ ì‚¬ìœ  ë“±
}

// ìŠ¹ì¸ ì‹œ ì²˜ë¦¬ ë¡œì§:
// 1. cancellation_requests.status = 'approved'
// 2. cancellation_requests.final_refund = final_refund
// 3. submission.status = 'cancellation_approved'
// 4. clients.points += final_refund
// 5. point_transactions INSERT (í™˜ë¶ˆ ê¸°ë¡)
// 6. notification INSERT (ê±°ë˜ì²˜ ì•Œë¦¼)
```

### 3.3 í™˜ë¶ˆ ê¸ˆì•¡ ìë™ ê³„ì‚° ë¡œì§

```typescript
// lib/refund-calculator.ts

export function calculateRefund(params: {
  totalPoints: number;
  progressRate: number;
  submissionType: string;
}): number {
  const { totalPoints, progressRate, submissionType } = params;

  // ê¸°ë³¸ í™˜ë¶ˆ ë¹„ìœ¨: ë¯¸ì§„í–‰ë¶„ 100% í™˜ë¶ˆ
  let refundRate = (100 - progressRate) / 100;

  // ìƒí’ˆë³„ ì¶”ê°€ ìˆ˜ìˆ˜ë£Œ ì ìš© (ì˜µì…˜)
  const serviceFees: Record<string, number> = {
    blog: 0.1,     // ë¸”ë¡œê·¸: 10% ìˆ˜ìˆ˜ë£Œ
    cafe: 0.1,     // ì¹´í˜: 10% ìˆ˜ìˆ˜ë£Œ
    kakaomap: 0.05, // ì¹´ì¹´ì˜¤ë§µ: 5% ìˆ˜ìˆ˜ë£Œ
    receipt: 0.05,  // ì˜ìˆ˜ì¦: 5% ìˆ˜ìˆ˜ë£Œ
    place: 0.05,    // í”Œë ˆì´ìŠ¤: 5% ìˆ˜ìˆ˜ë£Œ
  };

  const serviceFee = serviceFees[submissionType] || 0;
  const refundAmount = Math.floor(totalPoints * refundRate * (1 - serviceFee));

  return refundAmount;
}
```

---

## 4. ê´€ë¦¬ì í˜ì´ì§€ UI ì„¤ê³„

### 4.1 ëŒ€ì‹œë³´ë“œ í†µê³„ ì¹´ë“œ ìœ„ì¹˜

**íŒŒì¼**: `app/admin/admin-dashboard-content.tsx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì´ ì ‘ìˆ˜     â”‚  ì§„í–‰ ì¤‘    â”‚  AS ìš”ì²­    â”‚  ğŸ†• ì¤‘ë‹¨ ìš”ì²­       â”‚
â”‚    125      â”‚     42      â”‚     3       â”‚       5            â”‚
â”‚             â”‚             â”‚   âš ï¸ NEW   â”‚   âš ï¸ NEW           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìˆ˜ì • ì‚¬í•­**:
1. `app/admin/page.tsx`ì—ì„œ `cancellation_requests` í…Œì´ë¸”ì˜ pending ìƒíƒœ ì¹´ìš´íŠ¸ ì¡°íšŒ
2. `AdminDashboardContent`ì— ì¤‘ë‹¨ ìš”ì²­ í†µê³„ ì¹´ë“œ ì¶”ê°€
3. í´ë¦­ ì‹œ `/admin/as-requests?tab=cancellation` ì´ë™

### 4.2 AS ê´€ë¦¬ í˜ì´ì§€ íƒ­ êµ¬ì¡°

**íŒŒì¼**: `app/admin/as-requests/page.tsx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AS ê´€ë¦¬                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [AS ìš”ì²­]  [ğŸ†• ì¤‘ë‹¨ ìš”ì²­]                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ í•„í„°: [ì „ì²´ â–¼] [ëŒ€ê¸°ì¤‘ â–¼]          ê²€ìƒ‰: [          ]  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚No â”‚ ì—…ì²´ëª…  â”‚ ìƒí’ˆ   â”‚ ì§„í–‰ë¥  â”‚ ì˜ˆìƒí™˜ë¶ˆâ”‚ ìƒíƒœ   â”‚ ì•¡ì…˜  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ 1 â”‚ Aì¹´í˜  â”‚ ë¸”ë¡œê·¸ â”‚ 35%   â”‚ 65,000Pâ”‚ ëŒ€ê¸°   â”‚[ì²˜ë¦¬] â”‚â”‚
â”‚  â”‚ 2 â”‚ Bì‹ë‹¹  â”‚ ì¹´í˜   â”‚ 50%   â”‚ 45,000Pâ”‚ ëŒ€ê¸°   â”‚[ì²˜ë¦¬] â”‚â”‚
â”‚  â”‚ 3 â”‚ Cìƒµ    â”‚ ì˜ìˆ˜ì¦ â”‚ 80%   â”‚ 18,000Pâ”‚ ìŠ¹ì¸ë¨ â”‚[ìƒì„¸] â”‚â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ì¤‘ë‹¨ ìš”ì²­ ì²˜ë¦¬ ë‹¤ì´ì–¼ë¡œê·¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¤‘ë‹¨ ìš”ì²­ ì²˜ë¦¬                                        [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“‹ ìš”ì²­ ì •ë³´                                                â”‚
â”‚  â”œâ”€ ì—…ì²´ëª…: Aì¹´í˜                                           â”‚
â”‚  â”œâ”€ ìƒí’ˆ: ë¸”ë¡œê·¸ ë°°í¬ (ë¦¬ë·°ì–´)                               â”‚
â”‚  â”œâ”€ ìš”ì²­ì¼: 2026-01-02                                      â”‚
â”‚  â””â”€ ì‚¬ìœ : ë§ˆì¼€íŒ… ë°©í–¥ ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì¤‘ë‹¨ ìš”ì²­                   â”‚
â”‚                                                             â”‚
â”‚  ğŸ“Š ì§„í–‰ í˜„í™©                                                â”‚
â”‚  â”œâ”€ ì´ ìˆ˜ëŸ‰: 100ê±´                                          â”‚
â”‚  â”œâ”€ ì™„ë£Œ ìˆ˜ëŸ‰: 35ê±´                                         â”‚
â”‚  â”œâ”€ ì§„í–‰ë¥ : 35%                                             â”‚
â”‚  â””â”€ ë‚¨ì€ ìˆ˜ëŸ‰: 65ê±´                                         â”‚
â”‚                                                             â”‚
â”‚  ğŸ’° í™˜ë¶ˆ ê³„ì‚°                                                â”‚
â”‚  â”œâ”€ ì´ ê²°ì œê¸ˆì•¡: 100,000P                                    â”‚
â”‚  â”œâ”€ ë¯¸ì§„í–‰ë¶„: 65,000P                                        â”‚
â”‚  â”œâ”€ ìˆ˜ìˆ˜ë£Œ (10%): -6,500P                                    â”‚
â”‚  â”œâ”€ ìë™ ê³„ì‚° í™˜ë¶ˆ: 58,500P                                  â”‚
â”‚  â””â”€ í™•ì • í™˜ë¶ˆê¸ˆì•¡: [    58,500    ] P â† ìˆ˜ì • ê°€ëŠ¥            â”‚
â”‚                                                             â”‚
â”‚  ğŸ“ ê´€ë¦¬ì ë©”ëª¨ (ì„ íƒ)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚           [ê±°ì ˆ]                    [ìŠ¹ì¸ ë° í™˜ë¶ˆ]           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. í´ë¼ì´ì–¸íŠ¸ í˜ì´ì§€ UI ì„¤ê³„

### 5.1 ì ‘ìˆ˜ í˜„í™© í…Œì´ë¸” ìˆ˜ì •

**íŒŒì¼**: `components/dashboard/submissions/SubmissionTableRow.tsx`

```
ê¸°ì¡´ ìƒíƒœ ë±ƒì§€:
[ëŒ€ê¸°ì¤‘] [ì§„í–‰ì¤‘] [ì™„ë£Œ] [ì·¨ì†Œë¨]

ì¶”ê°€í•  ìƒíƒœ ë±ƒì§€:
[ì¤‘ë‹¨ìš”ì²­ì¤‘] - ë…¸ë€ìƒ‰, ê´€ë¦¬ì ê²€í†  ëŒ€ê¸°
[ì¤‘ë‹¨ìŠ¹ì¸] - íšŒìƒ‰, í™˜ë¶ˆ ì™„ë£Œ í‘œì‹œ

ì¤‘ë‹¨ìŠ¹ì¸ ìƒíƒœì¼ ë•Œ ì¶”ê°€ ì •ë³´:
â”œâ”€ í™˜ë¶ˆê¸ˆì•¡: 58,500P
â””â”€ ì²˜ë¦¬ì¼: 2026-01-03
```

### 5.2 ì¤‘ë‹¨ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸ (í´ë¼ì´ì–¸íŠ¸)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¤‘ë‹¨ ìš”ì²­                                             [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“‹ ì ‘ìˆ˜ ì •ë³´                                                â”‚
â”‚  â”œâ”€ ìƒí’ˆ: ë¸”ë¡œê·¸ ë°°í¬ (ë¦¬ë·°ì–´)                               â”‚
â”‚  â”œâ”€ ì—…ì²´ëª…: ë‚´ ê°€ê²Œ                                         â”‚
â”‚  â””â”€ ì ‘ìˆ˜ì¼: 2025-12-20                                      â”‚
â”‚                                                             â”‚
â”‚  ğŸ“Š í˜„ì¬ ì§„í–‰ í˜„í™©                                           â”‚
â”‚  â”œâ”€ ì´ ìˆ˜ëŸ‰: 100ê±´                                          â”‚
â”‚  â”œâ”€ ì™„ë£Œ ìˆ˜ëŸ‰: 35ê±´                                         â”‚
â”‚  â””â”€ ì§„í–‰ë¥ : 35%                                             â”‚
â”‚                                                             â”‚
â”‚  ğŸ’° ì˜ˆìƒ í™˜ë¶ˆ ê¸ˆì•¡                                           â”‚
â”‚  â”œâ”€ ì´ ê²°ì œê¸ˆì•¡: 100,000P                                    â”‚
â”‚  â”œâ”€ ì˜ˆìƒ í™˜ë¶ˆ: ì•½ 58,500P                                    â”‚
â”‚  â””â”€ âš ï¸ ìµœì¢… í™˜ë¶ˆ ê¸ˆì•¡ì€ ê´€ë¦¬ì ê²€í†  í›„ í™•ì •ë©ë‹ˆë‹¤             â”‚
â”‚                                                             â”‚
â”‚  ğŸ“ ì¤‘ë‹¨ ì‚¬ìœ  (ì„ íƒ)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ ì¤‘ë‹¨ ìš”ì²­ í›„ ê´€ë¦¬ì ìŠ¹ì¸ê¹Œì§€ ì„œë¹„ìŠ¤ê°€ ê³„ì† ì§„í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤â”‚
â”‚                                                             â”‚
â”‚           [ì·¨ì†Œ]                    [ì¤‘ë‹¨ ìš”ì²­í•˜ê¸°]          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. íŒŒì¼ êµ¬ì¡°

### 6.1 ì‹ ê·œ íŒŒì¼

```
app/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ cancellation-requests/
â”‚       â”œâ”€â”€ route.ts                    # POST, GET
â”‚       â””â”€â”€ [id]/
â”‚           â””â”€â”€ route.ts                # PATCH (ê´€ë¦¬ì ì²˜ë¦¬)
â”‚
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ as-requests/
â”‚       â””â”€â”€ cancellation-requests-table.tsx  # ì¤‘ë‹¨ ìš”ì²­ í…Œì´ë¸”
â”‚
components/
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ cancellation-requests/
â”‚       â”œâ”€â”€ CancellationRequestsTable.tsx    # í…Œì´ë¸” ì»´í¬ë„ŒíŠ¸
â”‚       â””â”€â”€ ProcessCancellationDialog.tsx    # ì²˜ë¦¬ ë‹¤ì´ì–¼ë¡œê·¸
â”‚
â”œâ”€â”€ dashboard/
â”‚   â””â”€â”€ submissions/
â”‚       â””â”€â”€ CancellationRequestDialog.tsx    # í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸
â”‚
lib/
â”œâ”€â”€ refund-calculator.ts               # í™˜ë¶ˆ ê³„ì‚° ìœ í‹¸ë¦¬í‹°
â”‚
types/
â”œâ”€â”€ cancellation-request.ts            # íƒ€ì… ì •ì˜
â”‚
supabase/
â””â”€â”€ migrations/
    â””â”€â”€ 20260103_cancellation_requests.sql  # ë§ˆì´ê·¸ë ˆì´ì…˜
```

### 6.2 ìˆ˜ì • íŒŒì¼

```
app/admin/
â”œâ”€â”€ page.tsx                           # ëŒ€ì‹œë³´ë“œ í†µê³„ì— ì¤‘ë‹¨ ìš”ì²­ ì¶”ê°€
â”œâ”€â”€ admin-dashboard-content.tsx        # ì¤‘ë‹¨ ìš”ì²­ ì¹´ë“œ ì¶”ê°€
â””â”€â”€ as-requests/
    â””â”€â”€ page.tsx                       # íƒ­ êµ¬ì¡° ì¶”ê°€

components/dashboard/submissions/
â”œâ”€â”€ SubmissionTableRow.tsx             # ìƒíƒœ ë±ƒì§€ ë° í™˜ë¶ˆ ì •ë³´ í‘œì‹œ
â”œâ”€â”€ SubmissionCard.tsx                 # ëª¨ë°”ì¼ ì¹´ë“œ ì—…ë°ì´íŠ¸
â””â”€â”€ CancelDialog.tsx                   # ì¤‘ë‹¨ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸ë¡œ ë³€ê²½

hooks/dashboard/
â””â”€â”€ useAllSubmissions.ts               # handleCancelClick â†’ handleCancellationRequest

lib/
â””â”€â”€ submission-utils.ts                # canCancel â†’ canRequestCancellation ë³€ê²½

types/
â”œâ”€â”€ submission.ts                      # ìƒíƒœ íƒ€ì… ì—…ë°ì´íŠ¸
â””â”€â”€ database.ts                        # í…Œì´ë¸” íƒ€ì… ì¶”ê°€
```

---

## 7. êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸´ê¸‰ ë²„ê·¸ ìˆ˜ì • (ìš°ì„ )
- [ ] `lib/submission-utils.ts`ì˜ `canCancel()` í•¨ìˆ˜ì—ì„œ cafe ìƒí’ˆ ì¡°ê±´ ìˆ˜ì •
- [ ] í…ŒìŠ¤íŠ¸ ë° í™•ì¸

### Phase 2: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
- [ ] `cancellation_requests` í…Œì´ë¸” ìƒì„± ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] ì•Œë¦¼ íŠ¸ë¦¬ê±° í•¨ìˆ˜ ì¶”ê°€
- [ ] ê¸°ì¡´ submission í…Œì´ë¸” ìƒíƒœ ì œì•½ ì¡°ê±´ ì—…ë°ì´íŠ¸

### Phase 3: íƒ€ì… ë° ìœ í‹¸ë¦¬í‹°
- [ ] `types/cancellation-request.ts` ìƒì„±
- [ ] `types/database.ts` ì—…ë°ì´íŠ¸
- [ ] `lib/refund-calculator.ts` ìƒì„±

### Phase 4: í´ë¼ì´ì–¸íŠ¸ API
- [ ] `POST /api/cancellation-requests` êµ¬í˜„
- [ ] `GET /api/cancellation-requests` êµ¬í˜„
- [ ] ê¸°ì¡´ ì·¨ì†Œ API ë¹„í™œì„±í™” ë˜ëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸

### Phase 5: ê´€ë¦¬ì API
- [ ] `PATCH /api/cancellation-requests/[id]` êµ¬í˜„
- [ ] ìŠ¹ì¸ ì‹œ í¬ì¸íŠ¸ í™˜ë¶ˆ ë¡œì§
- [ ] submission ìƒíƒœ ì—…ë°ì´íŠ¸ ë¡œì§

### Phase 6: ê´€ë¦¬ì UI
- [ ] ëŒ€ì‹œë³´ë“œ í†µê³„ ì¹´ë“œ ì¶”ê°€
- [ ] AS ê´€ë¦¬ í˜ì´ì§€ íƒ­ êµ¬ì¡° ë³€ê²½
- [ ] `CancellationRequestsTable.tsx` ì»´í¬ë„ŒíŠ¸ ìƒì„±
- [ ] `ProcessCancellationDialog.tsx` ë‹¤ì´ì–¼ë¡œê·¸ ìƒì„±

### Phase 7: í´ë¼ì´ì–¸íŠ¸ UI
- [ ] `CancellationRequestDialog.tsx` ìƒì„±
- [ ] `SubmissionTableRow.tsx` ìƒíƒœ ë±ƒì§€ ì—…ë°ì´íŠ¸
- [ ] `useAllSubmissions.ts` í•¸ë“¤ëŸ¬ ë³€ê²½

### Phase 8: í…ŒìŠ¤íŠ¸ ë° ë§ˆë¬´ë¦¬
- [ ] ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [ ] ì—£ì§€ ì¼€ì´ìŠ¤ í™•ì¸
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

## 8. ì£¼ìš” ê³ ë ¤ì‚¬í•­

### 8.1 ë™ì‹œì„± ì²˜ë¦¬
- ì¤‘ë‹¨ ìš”ì²­ ì¤‘ì—ë„ ì‘ì—…ì´ ì§„í–‰ë  ìˆ˜ ìˆìŒ
- ìŠ¹ì¸ ì‹œì ì˜ ì§„í–‰ë¥ ë¡œ ìµœì¢… í™˜ë¶ˆ ê³„ì‚°
- ì™„ë£Œëœ ê±´ìˆ˜ê°€ ìš”ì²­ ì‹œì ë³´ë‹¤ ì¦ê°€í•  ìˆ˜ ìˆìŒì„ ê³ ë ¤

### 8.2 ìƒíƒœ ì „ì´
```
[pending/in_progress]
    â†’ [cancellation_requested] (í´ë¼ì´ì–¸íŠ¸ ì¤‘ë‹¨ ìš”ì²­)
    â†’ [cancellation_approved] (ê´€ë¦¬ì ìŠ¹ì¸)
    ë˜ëŠ” â†’ [in_progress] (ê´€ë¦¬ì ê±°ì ˆ, ì›ë˜ ìƒíƒœë¡œ)
```

### 8.3 í™˜ë¶ˆ ì •ì±…
- ê¸°ë³¸: ë¯¸ì§„í–‰ë¶„ 100% - ìˆ˜ìˆ˜ë£Œ
- ìˆ˜ìˆ˜ë£Œìœ¨ì€ ìƒí’ˆë³„ë¡œ ë‹¤ë¥´ê²Œ ì„¤ì • ê°€ëŠ¥
- ê´€ë¦¬ìê°€ ìµœì¢… ê¸ˆì•¡ ì¡°ì • ê°€ëŠ¥

### 8.4 ì•Œë¦¼ ì‹œë‚˜ë¦¬ì˜¤
1. í´ë¼ì´ì–¸íŠ¸ â†’ ì¤‘ë‹¨ ìš”ì²­ â†’ ê´€ë¦¬ì ì•Œë¦¼
2. ê´€ë¦¬ì â†’ ìŠ¹ì¸ â†’ í´ë¼ì´ì–¸íŠ¸ ì•Œë¦¼ (í™˜ë¶ˆ ê¸ˆì•¡ í¬í•¨)
3. ê´€ë¦¬ì â†’ ê±°ì ˆ â†’ í´ë¼ì´ì–¸íŠ¸ ì•Œë¦¼ (ê±°ì ˆ ì‚¬ìœ  í¬í•¨)

---

## 9. ì˜ˆìƒ ì‘ì—… ì‹œê°„

| Phase | ë‚´ìš© | íŒŒì¼ ìˆ˜ |
|-------|------|--------|
| 1 | ë²„ê·¸ ìˆ˜ì • | 1 |
| 2 | DB ì„¤ì • | 1 |
| 3 | íƒ€ì…/ìœ í‹¸ | 3 |
| 4 | í´ë¼ì´ì–¸íŠ¸ API | 2 |
| 5 | ê´€ë¦¬ì API | 1 |
| 6 | ê´€ë¦¬ì UI | 4 |
| 7 | í´ë¼ì´ì–¸íŠ¸ UI | 4 |
| 8 | í…ŒìŠ¤íŠ¸ | - |

**ì´ ì˜ˆìƒ íŒŒì¼**: ì‹ ê·œ 11ê°œ + ìˆ˜ì • 10ê°œ = 21ê°œ íŒŒì¼

---

## 10. ì°¸ê³ : AS ìš”ì²­ ì‹œìŠ¤í…œê³¼ì˜ ì°¨ì´ì 

| êµ¬ë¶„ | AS ìš”ì²­ | ì¤‘ë‹¨ ìš”ì²­ |
|------|---------|----------|
| ëª©ì  | ë¯¸ë‹¬ ìˆ˜ëŸ‰ ë³´ì¶© ìš”ì²­ | ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ë° í™˜ë¶ˆ |
| ì¡°ê±´ | ì™„ë£Œ í›„ ë¯¸ë‹¬ë¥  20% ì´ìƒ | ì§„í–‰ ì¤‘ ì–¸ì œë“ ì§€ |
| ê²°ê³¼ | ì¶”ê°€ ì‘ì—… ì§„í–‰ | í¬ì¸íŠ¸ í™˜ë¶ˆ |
| ë¹„ìš© | ì¶”ê°€ ë¹„ìš© ì—†ìŒ | ìˆ˜ìˆ˜ë£Œ ë°œìƒ ê°€ëŠ¥ |

---

*ì‘ì„±ì¼: 2026-01-03*
*ì‘ì„±ì: Claude Code Assistant*
