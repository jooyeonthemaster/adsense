# 구현 계획서 - 무료 처리 항목 (20건)

## 📋 개요
- **총 항목**: 20건
- **비용**: 무료
- **카테고리**: 버그 수정 7건 + UI/UX 개선 13건
- **우선순위**: 긴급(1건) + 높음(6건) + 중간(13건)

---

## 🔴 긴급 버그 (최우선 처리)

### 1. 필수정보 팝업 신규 회원 미표시 버그

**현재 상황**:
```typescript
// app/dashboard/layout.tsx:22-25
if (client?.onboarding_completed === false) {
  redirect('/onboarding');
}
```
- `onboarding_completed`가 `null`일 때 체크 안됨
- 신규 가입자가 온보딩 팝업을 볼 수 없음

**구현 계획**:

#### Step 1: 버그 수정
```typescript
// app/dashboard/layout.tsx
if (!client?.onboarding_completed) {
  redirect('/onboarding');
}
```

#### Step 2: Null 체크 추가 위치
- `app/dashboard/layout.tsx` (Line 22-25)
- `app/onboarding/page.tsx` (Line 93-94) - 동일한 패턴 확인

#### Step 3: 테스트 계획
1. 신규 가입자 생성 (onboarding_completed = null)
2. 대시보드 접근 시 온보딩 리디렉트 확인
3. 기존 사용자 (onboarding_completed = true) 정상 동작 확인

**체크리스트**:
- [ ] `app/dashboard/layout.tsx` 수정
- [ ] `app/onboarding/page.tsx` 수정 (동일 패턴)
- [ ] 신규 가입자 테스트
- [ ] 기존 사용자 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 10분

---

## 🟡 높은 우선순위 버그 수정

### 2. 외부계정 충전 비용 청구 버그

**현재 상황**:
- 외부 계정 사용 시 비용이 청구되지 않음
- 매출 누락 가능성

**구현 계획**:

#### Step 1: 외부 계정 충전 로직 파악
```bash
# 관련 파일 검색
app/api/admin/clients/[id]/external-account/route.ts
```

#### Step 2: 비용 청구 로직 추가
```typescript
// 외부 계정 충전 시
await supabase
  .from('client_transactions')
  .insert({
    client_id,
    amount: charge_amount,
    type: 'external_account_charge',
    description: '외부 계정 충전 비용',
  });
```

#### Step 3: 테스트
1. 외부 계정 충전 요청
2. 트랜잭션 테이블에 기록 확인
3. 클라이언트 잔액 차감 확인

**체크리스트**:
- [ ] 외부 계정 충전 API 확인
- [ ] 비용 청구 로직 추가
- [ ] 트랜잭션 기록 확인
- [ ] 잔액 차감 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 30분

---

### 3. 리워드 중단 요청 후 오류

**현재 상황**:
- 리워드 중단 요청 후 오류 발생

**구현 계획**:

#### Step 1: 중단 요청 플로우 확인
```typescript
// app/api/admin/reward/[id]/cancel/route.ts
// components/admin/reward-management/cancel-dialog.tsx
```

#### Step 2: 에러 처리 개선
```typescript
try {
  // 중단 로직
  await supabase
    .from('place_submissions')
    .update({ status: 'cancelled' })
    .eq('id', submissionId);

  // 포인트 환불 처리
  await handleRefund(submissionId);

  return { success: true };
} catch (error) {
  console.error('Cancel error:', error);
  return { error: '중단 처리 중 오류가 발생했습니다.' };
}
```

#### Step 3: 트랜잭션 처리
- 중단 요청과 환불을 하나의 트랜잭션으로 처리

**체크리스트**:
- [ ] 중단 요청 API 확인
- [ ] 에러 핸들링 추가
- [ ] 트랜잭션 처리 구현
- [ ] 중단 후 상태 확인 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 30분

---

### 4. 리워드 진행일 탭 이동 오류

**현재 상황**:
- 진행일 탭 클릭 시 오류 발생

**구현 계획**:

#### Step 1: 진행일 컴포넌트 확인
```typescript
// components/dashboard/reward-status/daily-progress-tab.tsx
```

#### Step 2: 데이터 로딩 로직 수정
```typescript
const { data: dailyProgress, error } = await supabase
  .from('place_daily_progress')
  .select('*')
  .eq('submission_id', submissionId)
  .order('progress_date', { ascending: false });

if (error) {
  console.error('Daily progress error:', error);
  return [];
}
```

#### Step 3: 빈 데이터 처리
```typescript
{dailyProgress?.length === 0 ? (
  <div>진행 내역이 없습니다.</div>
) : (
  <DailyProgressList data={dailyProgress} />
)}
```

**체크리스트**:
- [ ] 진행일 탭 컴포넌트 확인
- [ ] 데이터 로딩 에러 처리
- [ ] 빈 데이터 UI 처리
- [ ] 탭 전환 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 20분

---

### 5. 리워드 현황 검토 중 갯수 오류

**현재 상황**:
- "검토 중" 상태 카운트가 정확하지 않음

**구현 계획**:

#### Step 1: 통계 쿼리 확인
```typescript
// app/api/dashboard/reward/stats/route.ts
const { count: pendingCount } = await supabase
  .from('place_submissions')
  .select('*', { count: 'exact', head: true })
  .eq('client_id', clientId)
  .eq('status', 'pending');
```

#### Step 2: 상태 값 검증
- DB에 저장된 status 값 확인
- 'pending' vs 'review' vs 'checking' 등 통일

#### Step 3: 캐시 무효화
```typescript
revalidatePath('/dashboard/reward/status');
```

**체크리스트**:
- [ ] 통계 API 쿼리 확인
- [ ] DB 상태 값 검증
- [ ] 캐시 무효화 추가
- [ ] 실시간 카운트 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 20분

---

### 6. 관리자 - 통합 접수 현황 수정

**현재 상황**:
- 관리자 통합 접수 현황 페이지에 문제

**구현 계획**:

#### Step 1: 통합 접수 현황 페이지 확인
```typescript
// app/admin/submissions/page.tsx
// app/admin/submissions/admin-submissions-table.tsx
```

#### Step 2: 데이터 집계 로직 수정
```typescript
// 모든 상품 타입의 접수 현황 통합
const allSubmissions = await Promise.all([
  getPlaceSubmissions(),
  getReceiptSubmissions(),
  getKakaomapSubmissions(),
  getBlogSubmissions(),
  getCafeSubmissions(),
  getExperienceSubmissions(),
]);

const unified = allSubmissions.flat().sort((a, b) =>
  new Date(b.created_at).getTime() - new Date(a.created_at).getTime()
);
```

#### Step 3: 필터링 및 검색 수정
```typescript
// 상품 타입별 필터링
const filtered = unified.filter(item => {
  if (productFilter && item.product_type !== productFilter) return false;
  if (statusFilter && item.status !== statusFilter) return false;
  if (searchTerm && !item.company_name.includes(searchTerm)) return false;
  return true;
});
```

**체크리스트**:
- [ ] 통합 접수 현황 페이지 확인
- [ ] 데이터 집계 로직 수정
- [ ] 필터링 기능 테스트
- [ ] 검색 기능 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 30분

---

### 7. 관리자 - 통합 접수 현황 통계 수정

**현재 상황**:
- 통합 접수 현황의 통계 숫자가 부정확

**구현 계획**:

#### Step 1: 통계 집계 로직 확인
```typescript
// app/api/admin/submissions/stats/route.ts
const stats = {
  total: allSubmissions.length,
  pending: allSubmissions.filter(s => s.status === 'pending').length,
  in_progress: allSubmissions.filter(s => s.status === 'in_progress').length,
  completed: allSubmissions.filter(s => s.status === 'completed').length,
  cancelled: allSubmissions.filter(s => s.status === 'cancelled').length,
  total_cost: allSubmissions.reduce((sum, s) => sum + s.total_points, 0),
};
```

#### Step 2: 실시간 업데이트
```typescript
// 상태 변경 시 통계 재계산
useEffect(() => {
  fetchStats();
}, [submissions]);
```

#### Step 3: 캐시 관리
```typescript
// 접수 생성/수정 시 캐시 무효화
revalidatePath('/admin/submissions');
```

**체크리스트**:
- [ ] 통계 API 확인
- [ ] 집계 로직 수정
- [ ] 실시간 업데이트 구현
- [ ] 캐시 무효화 추가
- [ ] 통계 정확성 테스트

**예상 작업 시간**: 30분

---

## 🟢 UI/UX 개선 항목

### 8. 리워드 진행 현황 "인스타 매체" 추가

**구현 계획**:

#### Step 1: 매체 설정 추가
```typescript
// config/submission-products.ts 또는 types/submission.ts
export const MEDIA_TYPES = {
  naver_blog: '네이버 블로그',
  instagram: '인스타그램', // 추가
  youtube: '유튜브',
  // ...
};
```

#### Step 2: UI 컴포넌트 수정
```typescript
// components/dashboard/reward-status/media-filter.tsx
<Select>
  <SelectItem value="naver_blog">네이버 블로그</SelectItem>
  <SelectItem value="instagram">인스타그램</SelectItem>
  <SelectItem value="youtube">유튜브</SelectItem>
</Select>
```

#### Step 3: 필터링 로직 추가
```typescript
const filtered = submissions.filter(s => {
  if (mediaFilter === 'instagram') {
    return s.media_type === 'instagram';
  }
  return true;
});
```

**체크리스트**:
- [ ] 매체 타입 상수 추가
- [ ] UI 선택 옵션 추가
- [ ] 필터링 로직 구현
- [ ] 화면 표시 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 15분

---

### 9. 영수증 리뷰 "검토 중" 카테고리 추가

**구현 계획**:

#### Step 1: 상태 타입 확인
```typescript
// types/submission.ts
export type SubmissionStatus =
  | 'pending'      // 검토 중 (추가)
  | 'in_progress'
  | 'completed'
  | 'cancelled'
  | 'as_in_progress';
```

#### Step 2: 상태 설정 추가
```typescript
// config/submission-products.ts
export const statusConfig = {
  pending: { label: '검토 중', variant: 'outline' },
  // ...
};
```

#### Step 3: 필터 UI 추가
```typescript
<TabsList>
  <TabsTrigger value="all">전체</TabsTrigger>
  <TabsTrigger value="pending">검토 중</TabsTrigger>
  <TabsTrigger value="in_progress">구동 중</TabsTrigger>
  <TabsTrigger value="completed">완료</TabsTrigger>
</TabsList>
```

**체크리스트**:
- [ ] 상태 타입 확인 (이미 존재)
- [ ] 필터 UI 추가
- [ ] 필터링 로직 구현
- [ ] 상태별 개수 표시
- [ ] 빌드 확인

**예상 작업 시간**: 15분

---

### 10. 카카오맵 리뷰 "검토 중" 카테고리 추가

**구현 계획**: (영수증 리뷰와 동일)

#### Step 1-3: 동일한 패턴 적용
```typescript
// components/dashboard/review/kmap/status-tabs.tsx
```

**체크리스트**:
- [ ] 필터 UI 추가
- [ ] 필터링 로직 구현
- [ ] 상태별 개수 표시
- [ ] 빌드 확인

**예상 작업 시간**: 15분

---

### 11. VAT 10% 추가 표시

**구현 계획**:

#### Step 1: 가격 표시 컴포넌트 수정
```typescript
// 기존 가격 표시
<div className="text-2xl font-bold">
  {totalPoints.toLocaleString()}원
</div>

// VAT 포함 가격 추가
<div className="text-sm text-gray-500">
  (VAT 포함: {(totalPoints * 1.1).toLocaleString()}원)
</div>
```

#### Step 2: 적용 위치
- 접수 폼 (총 비용 표시)
- 가격 설정 페이지
- 견적서/청구서

#### Step 3: UI 디자인
```typescript
<div className="border-t pt-4">
  <div className="flex justify-between mb-2">
    <span className="text-gray-600">공급가액</span>
    <span className="font-semibold">{price.toLocaleString()}원</span>
  </div>
  <div className="flex justify-between mb-2">
    <span className="text-gray-600">부가세 (10%)</span>
    <span className="font-semibold">{(price * 0.1).toLocaleString()}원</span>
  </div>
  <div className="flex justify-between text-lg font-bold border-t pt-2">
    <span>합계</span>
    <span>{(price * 1.1).toLocaleString()}원</span>
  </div>
</div>
```

**체크리스트**:
- [ ] 가격 표시 컴포넌트 수정
- [ ] 접수 폼 UI 업데이트
- [ ] 가격 설정 페이지 업데이트
- [ ] 견적서/청구서 업데이트
- [ ] UI 디자인 확인

**예상 작업 시간**: 20분

---

### 12. 리워드 잔액 표시 (메인/진행 현황)

**구현 계획**:

#### Step 1: 잔액 조회 API
```typescript
// app/api/client/balance/route.ts
export async function GET() {
  const { data: client } = await supabase
    .from('clients')
    .select('remaining_points')
    .eq('id', clientId)
    .single();

  return Response.json({ balance: client.remaining_points });
}
```

#### Step 2: 잔액 표시 컴포넌트
```typescript
// components/dashboard/balance-display.tsx
export function BalanceDisplay() {
  const { data } = useSWR('/api/client/balance');

  return (
    <div className="bg-blue-50 p-4 rounded-lg">
      <div className="text-sm text-gray-600">잔여 포인트</div>
      <div className="text-2xl font-bold text-blue-600">
        {data?.balance.toLocaleString()}P
      </div>
    </div>
  );
}
```

#### Step 3: 배치 위치
- 메인 대시보드 (상단 우측)
- 리워드 진행 현황 (헤더)

**체크리스트**:
- [ ] 잔액 조회 API 구현
- [ ] 잔액 표시 컴포넌트 작성
- [ ] 메인 대시보드 배치
- [ ] 진행 현황 페이지 배치
- [ ] 실시간 업데이트 테스트

**예상 작업 시간**: 20분

---

### 13. 영수증 리뷰 잔액 표시

**구현 계획**: (리워드 잔액과 동일 API 사용)

#### Step 1: 동일한 컴포넌트 재사용
```typescript
// components/dashboard/visitor-review/page.tsx
<BalanceDisplay />
```

**체크리스트**:
- [ ] 잔액 컴포넌트 배치
- [ ] UI 확인
- [ ] 빌드 확인

**예상 작업 시간**: 10분

---

### 14. 카카오맵 리뷰 잔액 표시

**구현 계획**: (동일)

**체크리스트**:
- [ ] 잔액 컴포넌트 배치
- [ ] UI 확인
- [ ] 빌드 확인

**예상 작업 시간**: 10분

---

### 15. 블로그 배포 잔액 표시

**구현 계획**: (동일)

**체크리스트**:
- [ ] 잔액 컴포넌트 배치
- [ ] UI 확인
- [ ] 빌드 확인

**예상 작업 시간**: 10분

---

### 16. 카페 침투 마케팅 잔액 표시

**구현 계획**: (동일)

**체크리스트**:
- [ ] 잔액 컴포넌트 배치
- [ ] UI 확인
- [ ] 빌드 확인

**예상 작업 시간**: 10분

---

### 17. 체험단 마케팅 잔액 표시

**구현 계획**: (동일)

**체크리스트**:
- [ ] 잔액 컴포넌트 배치
- [ ] UI 확인
- [ ] 빌드 확인

**예상 작업 시간**: 10분

---

### 18. 카카오맵 목록 "리뷰어명" 필터 추가

**구현 계획**:

#### Step 1: 리뷰어 목록 조회
```typescript
// app/api/admin/kakaomap/reviewers/route.ts
const { data: reviewers } = await supabase
  .from('kakaomap_reviewers')
  .select('id, name')
  .order('name');
```

#### Step 2: 필터 UI 추가
```typescript
<Select onValueChange={setReviewerFilter}>
  <SelectTrigger>
    <SelectValue placeholder="리뷰어 선택" />
  </SelectTrigger>
  <SelectContent>
    <SelectItem value="all">전체</SelectItem>
    {reviewers?.map(r => (
      <SelectItem key={r.id} value={r.id}>{r.name}</SelectItem>
    ))}
  </SelectContent>
</Select>
```

#### Step 3: 필터링 적용
```typescript
const filtered = items.filter(item => {
  if (reviewerFilter !== 'all') {
    return item.reviewer_id === reviewerFilter;
  }
  return true;
});
```

**체크리스트**:
- [ ] 리뷰어 목록 API 구현
- [ ] 필터 UI 추가
- [ ] 필터링 로직 구현
- [ ] 리뷰어별 접수 현황 테스트
- [ ] 빌드 확인

**예상 작업 시간**: 25분

---

### 19. 리워드 잔액 표시 (메인)

**구현 계획**: (12번과 중복, 이미 처리됨)

**체크리스트**:
- [x] 이미 12번에서 처리됨

---

### 20. 리워드 접수 문구 수정

**구현 계획**:

#### Step 1: 문구 확인 및 수정
```typescript
// components/dashboard/reward/submission-form.tsx
// 기존 문구 찾기
<p className="text-gray-600">
  리워드 마케팅을 접수해주세요.
</p>

// 수정된 문구로 변경
<p className="text-gray-600">
  {새로운 문구} // 클라이언트에게 정확한 문구 확인 필요
</p>
```

#### Step 2: 적용 위치
- 리워드 접수 페이지
- 리워드 관련 안내 문구

**체크리스트**:
- [ ] 클라이언트에게 정확한 문구 확인
- [ ] 접수 페이지 문구 수정
- [ ] 관련 안내 문구 수정
- [ ] UI 확인
- [ ] 빌드 확인

**예상 작업 시간**: 10분 (문구 확인 후)

---

## 📊 무료 처리 항목 요약

| 순번 | 항목 | 카테고리 | 우선순위 | 예상 시간 |
|-----|------|---------|---------|----------|
| 1 | 필수정보 팝업 신규 회원 미표시 버그 | 버그 | 긴급 | 10분 |
| 2 | 외부계정 충전 비용 청구 버그 | 버그 | 높음 | 30분 |
| 3 | 리워드 중단 요청 후 오류 | 버그 | 높음 | 30분 |
| 4 | 리워드 진행일 탭 이동 오류 | 버그 | 높음 | 20분 |
| 5 | 리워드 현황 검토 중 갯수 오류 | 버그 | 높음 | 20분 |
| 6 | 관리자 - 통합 접수 현황 수정 | 버그 | 높음 | 30분 |
| 7 | 관리자 - 통합 접수 현황 통계 수정 | 버그 | 높음 | 30분 |
| 8 | 리워드 진행 현황 "인스타 매체" 추가 | UI/UX | 중간 | 15분 |
| 9 | 영수증 리뷰 "검토 중" 카테고리 추가 | UI/UX | 중간 | 15분 |
| 10 | 카카오맵 리뷰 "검토 중" 카테고리 추가 | UI/UX | 중간 | 15분 |
| 11 | VAT 10% 추가 표시 | UI/UX | 중간 | 20분 |
| 12 | 리워드 잔액 표시 (메인/진행 현황) | UI/UX | 중간 | 20분 |
| 13 | 영수증 리뷰 잔액 표시 | UI/UX | 중간 | 10분 |
| 14 | 카카오맵 리뷰 잔액 표시 | UI/UX | 중간 | 10분 |
| 15 | 블로그 배포 잔액 표시 | UI/UX | 중간 | 10분 |
| 16 | 카페 침투 마케팅 잔액 표시 | UI/UX | 중간 | 10분 |
| 17 | 체험단 마케팅 잔액 표시 | UI/UX | 중간 | 10분 |
| 18 | 카카오맵 목록 "리뷰어명" 필터 추가 | UI/UX | 중간 | 25분 |
| 19 | 리워드 잔액 표시 (메인) | UI/UX | 중복 | - |
| 20 | 리워드 접수 문구 수정 | UI/UX | 중간 | 10분 |

**총 예상 작업 시간**: 약 5시간 (버그 2.5시간 + UI/UX 2.5시간)

---

## 🎯 구현 순서 권장사항

### Phase 1: 긴급 버그 (즉시)
1. 필수정보 팝업 버그 수정 → 배포

### Phase 2: 높은 우선순위 버그 (당일)
2. 외부계정 충전 비용 청구
3. 리워드 중단 요청 오류
4. 리워드 진행일 탭 오류
5. 리워드 검토 중 갯수 오류
6. 통합 접수 현황 수정
7. 통합 접수 현황 통계 수정

### Phase 3: UI/UX 개선 (1-2일)
8-20. UI/UX 개선 항목 일괄 처리
- 잔액 표시 (12-17) 함께 처리
- 검토 중 카테고리 (9-10) 함께 처리
- 필터 추가 (8, 18) 함께 처리
- 기타 개선 사항

---

## ✅ 전체 체크리스트

### 버그 수정
- [ ] 1. 필수정보 팝업 신규 회원 미표시 버그
- [ ] 2. 외부계정 충전 비용 청구 버그
- [ ] 3. 리워드 중단 요청 후 오류
- [ ] 4. 리워드 진행일 탭 이동 오류
- [ ] 5. 리워드 현황 검토 중 갯수 오류
- [ ] 6. 관리자 - 통합 접수 현황 수정
- [ ] 7. 관리자 - 통합 접수 현황 통계 수정

### UI/UX 개선
- [ ] 8. 리워드 진행 현황 "인스타 매체" 추가
- [ ] 9. 영수증 리뷰 "검토 중" 카테고리 추가
- [ ] 10. 카카오맵 리뷰 "검토 중" 카테고리 추가
- [ ] 11. VAT 10% 추가 표시
- [ ] 12. 리워드 잔액 표시 (메인/진행 현황)
- [ ] 13. 영수증 리뷰 잔액 표시
- [ ] 14. 카카오맵 리뷰 잔액 표시
- [ ] 15. 블로그 배포 잔액 표시
- [ ] 16. 카페 침투 마케팅 잔액 표시
- [ ] 17. 체험단 마케팅 잔액 표시
- [ ] 18. 카카오맵 목록 "리뷰어명" 필터 추가
- [ ] 20. 리워드 접수 문구 수정

### 최종 검증
- [ ] 전체 빌드 성공
- [ ] TypeScript 에러 없음
- [ ] 린트 에러 없음
- [ ] 기능 테스트 완료
- [ ] 배포 준비 완료
